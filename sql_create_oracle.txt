
CREATE TABLE category (
    category_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    name        VARCHAR2(40) NOT NULL,
    description VARCHAR2(200) NOT NULL
);

ALTER TABLE category ADD CONSTRAINT category_pk PRIMARY KEY ( category_id );

CREATE TABLE payment (
    payment_id     INTEGER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    type           VARCHAR2(50) NOT NULL,
    payment_date   DATE NOT NULL,
    amount         NUMBER NOT NULL,
    rental_id      INTEGER NOT NULL,
    payment_status VARCHAR2(20) NOT NULL
);

ALTER TABLE payment ADD CONSTRAINT payment_pk PRIMARY KEY ( payment_id );

CREATE TABLE rental (
    rental_id         INTEGER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    date_from         DATE NOT NULL,
    date_to           DATE NOT NULL,
    rental_status     VARCHAR2(20) NOT NULL,
    date_returned     DATE,
    customer_user_id  INTEGER NOT NULL,
    employee_user_id  INTEGER NOT NULL
);

ALTER TABLE rental ADD CONSTRAINT rental_pk PRIMARY KEY ( rental_id );

CREATE TABLE rental_history (
    modified_at DATE NOT NULL,
    old_date_to DATE NOT NULL,
    new_date_to DATE NOT NULL,
    rental_id   INTEGER NOT NULL,
    user_id     INTEGER NOT NULL
);

ALTER TABLE rental_history ADD CONSTRAINT rental_history_pk PRIMARY KEY ( modified_at );

CREATE TABLE rental_ski (
    rental_id INTEGER NOT NULL,
    ski_id    INTEGER NOT NULL
);

ALTER TABLE rental_ski ADD CONSTRAINT renta_ski_pk PRIMARY KEY ( rental_id,
                                                                 ski_id );

CREATE TABLE ski (
    ski_id           INTEGER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    brand            VARCHAR2(50) NOT NULL,
    model            VARCHAR2(50) NOT NULL,
    length           INTEGER NOT NULL,
    price            NUMBER NOT NULL,
    description      VARCHAR2(200) NOT NULL,
    skier_experience VARCHAR2(20) NOT NULL,
    category_id      INTEGER NOT NULL
);

ALTER TABLE ski ADD CONSTRAINT ski_pk PRIMARY KEY ( ski_id );

CREATE TABLE "User" (
    user_id             INTEGER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    role                VARCHAR2(20) NOT NULL,
    first_name          VARCHAR2(70) NOT NULL,
    last_name           VARCHAR2(70) NOT NULL,
    email               VARCHAR2(100) NOT NULL,
    password            VARCHAR2(50) NOT NULL,
    address_town        VARCHAR2(40) NOT NULL,
    address_street      VARCHAR2(40) NOT NULL,
    address_postal_code VARCHAR2(10) NOT NULL,
    height              INTEGER,
    weight              INTEGER,
    user_ski_experience VARCHAR2(20),
    deleted_at          DATE
);

ALTER TABLE "User" ADD CONSTRAINT user_pk PRIMARY KEY ( user_id );

ALTER TABLE payment
    ADD CONSTRAINT payment_rental_fk FOREIGN KEY ( rental_id )
        REFERENCES rental ( rental_id );

ALTER TABLE rental_ski
    ADD CONSTRAINT rental_fk FOREIGN KEY ( rental_id )
        REFERENCES rental ( rental_id );

ALTER TABLE rental_history
    ADD CONSTRAINT rental_history_rental_fk FOREIGN KEY ( rental_id )
        REFERENCES rental ( rental_id );

ALTER TABLE rental_history
    ADD CONSTRAINT rental_history_user_fk FOREIGN KEY ( user_id )
        REFERENCES "User" ( user_id );

ALTER TABLE rental
    ADD CONSTRAINT rental_user_fk FOREIGN KEY ( customer_user_id )
        REFERENCES "User" ( user_id );

ALTER TABLE rental
    ADD CONSTRAINT rental_user_fkv2 FOREIGN KEY ( employee_user_id )
        REFERENCES "User" ( user_id );

ALTER TABLE ski
    ADD CONSTRAINT ski_category_fk FOREIGN KEY ( category_id )
        REFERENCES category ( category_id );

ALTER TABLE rental_ski
    ADD CONSTRAINT ski_fk FOREIGN KEY ( ski_id )
        REFERENCES ski ( ski_id );

